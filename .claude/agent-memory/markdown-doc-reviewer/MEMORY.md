# MMS Documentation Reviewer Memory

## Document Inventory
- `CLAUDE.md` -- Developer onboarding / AI assistant context (68 lines)
- `README.md` -- Full project README with architecture, Quick Start, operations, Proxmox setup, Traefik, age encryption, Auto-Deploy (~600 lines)
- `.claude/agents/ansible-reviewer.md` -- Ansible review agent definition
- `.claude/agents/supply-chain-hygiene-reviewer.md` -- Supply-chain review agent definition
- `.claude/agents/markdown-doc-reviewer.md` -- This agent's definition

## Terminology Conventions
- "Rootless Podman" (capitalized)
- "Quadlet" (capitalized when referring to the systemd integration)
- "mms" (lowercase when referring to the user/service name)
- SELinux boolean: `virt_use_nfs` (NOT `container_use_nfs` -- fixed in commit a222f8c)
- Variable prefixes: `mms_` (global), `vault_` (secrets)
- Heading style: sentence case in both CLAUDE.md and README.md
- List markers: `-` consistently
- Code blocks: `bash` for shell, `yaml` for YAML, bare fence for ASCII art

## Known Documentation Gaps (as of 2026-02-11)
- No CHANGELOG documenting the UID/GID change from 1100 to 3000
- No migration guide for existing deployments
- Fedora version (43) not mentioned in prose of CLAUDE.md or README.md (only in inventory)
- No LICENSE or CONTRIBUTING files (acceptable for personal homelab)
- Dead variable `immich_port` in roles/immich/defaults/main.yml (no longer published)
- CLAUDE.md Conventions missing: `mms_vm_hostname`/`mms_vm_name` split, `mms_vm_ssh_pubkeys` list, `Tmpfs=/run:U`, per-service `tmpfs`, `NoNewPrivileges`, Jellyfin official image
- CLAUDE.md Conventions missing: INI race condition pattern, `host_whitelist` inter-container DNS, `backup_api_*` variable prefix
- CLAUDE.md Architecture missing: backup subsystem bullet (config + API backups)
- CLAUDE.md Architecture missing: Immich volume split (NFS user content vs local SSD generated content)
- CLAUDE.md Conventions missing: Immich three-mount overlay pattern (`:Z` local base + NFS overlays)
- README Backup section missing: API backup at 04:30 (*arr to NAS), retention split, verification commands
- README Backup section missing: note that Immich config backup excludes regenerable content
- README Storage Layout missing: `/data/backups/` NFS mount and `arr-api/` subdirs
- README Storage Layout missing: `/home/mms/config/immich/media/` local SSD path for Immich generated content
- README Storage Layout: `/data/photos/` comment should say "user content" not just "uploads"
- README Migrate section missing: note about rsync skipping regenerable Immich content
- README Prerequisites missing: "backups" in NFS exports list
- README Quick Start step 2 file descriptions stale (VM specs/SSH keys moved to group_vars/all)
- supply-chain-hygiene-reviewer.md services list missing Channels DVR and Navidrome
- CLAUDE.md Conventions missing: deploy resilience pattern (block/rescue in deploy-services.yml)

## Source of Truth for Key Values
- UID/GID: `inventory/group_vars/all/vars.yml` lines 23-25 (currently 3000:3000)
- VM hostname: `inventory/group_vars/all/vars.yml` line 6 (`mms_vm_hostname`)
- VM display name: `inventory/group_vars/proxmox/vars.yml` line 18 (`mms_vm_name`)
- SSH public keys: `inventory/group_vars/all/vars.yml` lines 18-20 (`mms_vm_ssh_pubkeys` -- list)
- Traefik domain: `inventory/group_vars/all/vars.yml` line 50 (`mms_traefik_domain`)
- SELinux boolean: `roles/base_system/defaults/main.yml` line 20 (`virt_use_nfs`)
- Fedora version: `inventory/group_vars/proxmox/vars.yml` line 14 (Fedora 43)
- Services list: `inventory/group_vars/mms/vars.yml` lines 25-33
- Traefik routes: `inventory/group_vars/mms/vars.yml` lines 36-72 (`mms_traefik_routes`)
- Traefik role defaults: `roles/traefik/defaults/main.yml` (image, port 80, log level)
- Autodeploy defaults: `roles/autodeploy/defaults/main.yml` (groups, branch, timeout, retention)
- Autodeploy inventory override: `inventory/group_vars/mms/vars.yml` lines 74-94 (repo URL, groups)
- Jellyfin image: `services/jellyfin.yml` (`docker.io/jellyfin/jellyfin`, no PUID/PGID)
- Container template: `templates/quadlet/container.j2` (Tmpfs=/run:U, per-service tmpfs, NoNewPrivileges)
- Playbook names: `playbooks/` directory
- Backup role defaults: `roles/backup/defaults/main.yml` (config backup + API backup vars)
- Backup API services: `roles/backup/defaults/main.yml` lines 32-46 (`backup_api_*` prefix)
- NFS backups mount: `inventory/group_vars/mms/vars.yml` lines 23-25 (`/data/backups`)
- Base system packages: `roles/base_system/defaults/main.yml` lines 9-18 (includes btop, jq via backup role)
- Immich NFS dirs: `roles/immich/defaults/main.yml` lines 27-29 (`immich_nfs_dirs`: upload, library)
- Immich local dirs: `roles/immich/defaults/main.yml` lines 32-36 (`immich_local_dirs`: encoded-video, thumbs, profile, backups)
- Immich media dir: `roles/immich/defaults/main.yml` line 24 (`immich_media_dir`: `{{ mms_config_dir }}/immich/media`)
- Immich upload dir: `roles/immich/defaults/main.yml` line 21 (`immich_upload_dir`: /data/photos)

## Review History
- 2026-02-08: Full review of all .md files on fix/dry-run-issues branch (15 commits over main)
  - Found 3 files with stale UID 1100 (CLAUDE.md, README.md, supply-chain-hygiene-reviewer.md)
  - Found 1 missed Molecule fixture (testapp.yml PUID/PGID still 1100)
  - Found 1 stale ansible-reviewer memory entry (item #10 re: container_use_nfs)
  - SELinux boolean in CLAUDE.md already correctly says virt_use_nfs
  - README structure is comprehensive and well-organized
  - See review-findings.md for details
- 2026-02-08: Review of CLAUDE.md + README.md on feat/add-traefik-proxy branch
  - Traefik integration well-documented: architecture diagram, DNS setup, config, verification
  - No stale tailscale serve or port-publishing references in docs
  - tailscale role code correctly cleans up legacy serve (lines 44-52)
  - ASCII diagram line 32 is 1 char too wide (formatting bug)
  - README line 106: stale `vault_backup_age_public_key` (pre-existing, not Traefik-related)
  - CLAUDE.md missing `mms_traefik_domain`/`mms_traefik_routes` in Conventions section
- 2026-02-09: Review of Auto-Deploy section on feat/renovate-autodeploy branch
  - Per-group `autodeploy_groups` feature well-documented with examples
  - Variable table matches role defaults exactly
  - deploy-services.yml `deploy_services` filtering logic verified correct
  - Grammar fix needed on line 531 ("for that group's timer fires")
  - CLAUDE.md needs autodeploy role added to roles list and Architecture section
  - Autodeploy variable naming (bare vs mms_ prefix) could use a clarifying note
  - Missing troubleshooting/rollback/disable guidance (backlog items)
  - See review-findings.md for details
- 2026-02-10: Full review of all .md files on feat/multi-ssh-keys branch (9 commits over main)
  - `mms_vm_hostname`/`mms_vm_name` split not documented in CLAUDE.md or README.md
  - `mms_vm_ssh_pubkeys` (list) not reflected in README Quick Start (still says singular "SSH public key")
  - README Quick Start step 2 file descriptions stale (VM specs moved to group_vars/all)
  - CLAUDE.md Conventions missing: variable split, SSH keys list, Tmpfs/NoNewPrivileges, Jellyfin image
  - supply-chain-hygiene-reviewer.md missing Channels DVR and Navidrome
  - CLAUDE.md roles list now correctly includes autodeploy (prior gap resolved)
  - README backup variable name now correct (`mms_backup_age_public_key`, prior gap resolved)
  - Immich templates all have Tmpfs=/run:U (prior ansible-reviewer item #27 resolved)
  - See review-findings.md for details
- 2026-02-11: Review of all .md files on fix/sabnzbd-ini-race-condition branch (7 commits over main)
  - API backup system (mms-api-backup timer/service/script) entirely undocumented in README
  - `/data/backups/` NFS mount missing from storage layout diagram
  - Prerequisites missing "backups" in NFS exports list
  - CLAUDE.md missing backup architecture bullet and INI race/whitelist/backup_api conventions
  - Variable rename api_backup_* -> backup_api_* already correct in code, no stale doc refs
  - After=network-online.target fix correctly applied in both service templates
  - Inter-container access table is well-structured addition
  - See review-findings.md for details
- 2026-02-11: Review of all .md files on fix/base-system-packages branch (6 commits over main)
  - bpytop->btop: no public doc references; only agent memory files were stale
  - movies4k removal: README diagram complete/movies4k line correctly removed by branch
  - Immich /upload->/data mount: no doc references to container-internal mount path
  - Immich media subdirs + .immich markers: internal detail, no doc impact
  - Deploy resilience (block/rescue for Immich/Traefik): undocumented behavioral change
  - CLAUDE.md Conventions should note deploy resilience pattern
  - See review-findings.md for details
- 2026-02-11: Review of all .md files on feat/immich-split-volumes branch (1 commit over main)
  - Immich three-mount overlay: local SSD base at /data:Z, NFS overlays for upload/ and library/
  - README Storage Layout missing /home/mms/config/immich/media/ and NFS/local distinction
  - README Storage Layout /data/photos/ comment stale ("uploads" should be "user content")
  - CLAUDE.md Architecture Immich bullet missing volume split
  - CLAUDE.md Conventions missing Immich three-mount overlay pattern
  - README Backup section missing note about excluding regenerable content
  - README Migrate section missing note about rsync skipping regenerable content
  - Backup script --exclude='immich/media' correctly excludes local generated content
  - Migrate rsync excludes match immich_local_dirs (thumbs, encoded-video, profile, backups)
  - See review-findings.md for details
